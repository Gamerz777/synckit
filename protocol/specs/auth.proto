syntax = "proto3";

package synckit.protocol;

import "types.proto";

// Authentication request
message AuthRequest {
  // Authentication method
  enum AuthMethod {
    // JWT token authentication
    JWT = 0;
    
    // API key authentication
    API_KEY = 1;
    
    // Anonymous (read-only)
    ANONYMOUS = 2;
  }
  
  AuthMethod method = 1;
  
  // Credentials (method-specific)
  oneof credentials {
    // JWT token
    string jwt_token = 2;
    
    // API key
    string api_key = 3;
  }
  
  // Client information
  ClientInfo client_info = 4;
}

// Client information
message ClientInfo {
  // Client ID (persistent across sessions)
  ClientID client_id = 1;
  
  // Client type
  enum ClientType {
    WEB = 0;
    MOBILE = 1;
    DESKTOP = 2;
    SERVER = 3;
  }
  
  ClientType client_type = 2;
  
  // Client version
  string version = 3;
  
  // Platform details (e.g., "Chrome 120.0", "iOS 17.2")
  string platform = 4;
}

// Authentication response
message AuthResponse {
  // Authentication status
  Status status = 1;
  
  // Error message if authentication failed
  string error_message = 2;
  
  // Session token (if authenticated)
  string session_token = 3;
  
  // Session expiry (Unix timestamp)
  int64 expires_at = 4;
  
  // User/account information
  UserInfo user_info = 5;
  
  // Permissions granted
  Permissions permissions = 6;
}

// User information
message UserInfo {
  // User ID
  string user_id = 1;
  
  // User email (optional)
  string email = 2;
  
  // User display name (optional)
  string display_name = 3;
  
  // Account metadata
  map<string, string> metadata = 4;
}

// Permissions (RBAC)
message Permissions {
  // Document-level permissions
  map<string, DocumentPermission> documents = 1;
  
  // Global permissions
  bool can_create_documents = 2;
  bool can_delete_documents = 3;
  bool can_manage_users = 4;
}

// Permission for a specific document
message DocumentPermission {
  // Can read document
  bool can_read = 1;
  
  // Can write (modify) document
  bool can_write = 2;
  
  // Can delete document
  bool can_delete = 3;
  
  // Can share document with others
  bool can_share = 4;
  
  // Field-level permissions (optional)
  map<string, FieldPermission> fields = 5;
}

// Permission for a specific field
message FieldPermission {
  // Can read field
  bool can_read = 1;
  
  // Can write field
  bool can_write = 2;
}

// Token refresh request
message RefreshRequest {
  // Current session token
  string session_token = 1;
  
  // Optional: refresh token (for long-lived sessions)
  string refresh_token = 2;
}

// Token refresh response
message RefreshResponse {
  // Status
  Status status = 1;
  
  // New session token
  string session_token = 2;
  
  // New expiry time
  int64 expires_at = 3;
}

// Logout request
message LogoutRequest {
  // Session token to invalidate
  string session_token = 1;
}

// Logout response
message LogoutResponse {
  // Status
  Status status = 1;
}
